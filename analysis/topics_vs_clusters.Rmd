---
title: "Topics versus clusters: an illustration"
author: Peter Carbonetto
output: workflowr::wflow_html
---

*Add introductory text here.*

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.align = "center",dpi = 120)
```

Load packages used in the analysis below, as well as some functions
written for this analysis.

```{r load-pkgs, message=FALSE}
library(ggplot2)
library(cowplot)
library(Ternary)
library(Rtsne)
library(fastTopics)
source("../code/functions_for_topics_vs_clusters.R")
```

Simulate a gene expression data set.

```{r simulate-data}
set.seed(1)
X <- simulate_toy_gene_data(n = 400,m = 40,k = 3,s = 1000)$X
```

Fit a multinomial topic model to these data.

```{r fit-multinom-topic-model, message=FALSE}
fit <- fit_poisson_nmf(X,k = 3,numiter = 100,verbose = FALSE,
                       control = list(extrapolate = TRUE))
fit <- poisson2multinom(fit)
```

Plot the estimated topic proportions.

```{r plot-topic-proportions, fig.height=3, fig.width=3}
par(mar = c(0,0,0,0))
create_ternary_plot(fit$L)
```

To illustrate clustering, project the samples onto a 2-d embedding
using t-SNE.

```{r tsne-from-counts-1, fig.height=3, fig.width=3}
tsne1 <- Rtsne(X,2,pca = FALSE,normalize = FALSE)
plot_tsne(tsne1)
```

Compare with the topic modeling, label the samples by the topic that
is estimated to contribute most to that sample.

```{r tsne-from-counts-2, fig.height=3, fig.width=3}
plot_tsne_with_topics(tsne1,fit$L)
```

Now use t-SNE in the same way to project the topic proportions onto a
2-d embedding.

```{r tsne-from-loadings, fig.height=3, fig.width=3}
tsne2 <- Rtsne(fit$L,2,pca = FALSE,normalize = FALSE)
plot_tsne_with_topics(tsne2,fit$L)
```

We can achieve something similar with PCA.

```{r pca-from-loadings, fig.height=3, fig.width=3}
pca <- prcomp(fit$L,center = TRUE,scale = FALSE)
plot_pca(pca,fit$L)
```
