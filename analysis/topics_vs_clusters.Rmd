---
title: "Topics vs. clusters: an illustration"
author: Peter Carbonetto
output: workflowr::wflow_html
---

*Add introductory text here.*

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.align = "center")
```

These are thee packages used in the analysis below.

```{r load-pkgs, message=FALSE}
library(ggplot2)
library(cowplot)
library(Ternary)
```

Simulate data
-------------

*Add text here.*

```{r data-sim-params}
n <- 400
m <- 40
s <- 1000
k <- 3
```

Generate the "gene programs"; that is, the $m \times k$ matrix of gene
frequencies, $F$, by drawing numbers uniformly at random from
$[0, 1]$. Each column of $F$ is a gene program.

```{r simulate-gene-freqs}
set.seed(1)
F <- matrix(runif(m*k),m,k)
```

Generate the topic proportions; that is, for each sample $i = 1,
\ldots, n$, the proportion that each of the gene programs contributes
to that sample. For 90% of the samples, the counts are generated
primarily by a single gene program; the remaining samples are
generated by sampling roughly equally from all three gene programs.

```{r simulate-loadings}
L <- matrix(0,n,k)
for (i in 1:n) {
  if (runif(1) < 0.9) {
    x <- rep(0,k)
    x[sample(k,1)] <- 1
  } else
    x <- rep(1/k,k)
  x <- x + abs(rnorm(k,0,0.15))
  L[i,] <- x/sum(x)
}
```

Simulate the $n \times m$ counts from the multinomial topic model.

```{r simulate-counts}
X <- matrix(0,n,m)
P <- tcrossprod(L,F)
for (i in 1:n)
  X[i,] <- rmultinom(1,s,P[i,])
```

Plot the topic proportions.

```{r plot-topic-proportions, fig.height=4, fig.width=4}
par(mar = c(0,0,0,0))
colnames(L) <- paste0("k",1:k)
TernaryPlot(alab = "k1",blab = "k2",clab = "k3",grid.col = "skyblue",
            grid.minor.lines = 0)
TernaryPoints(as.data.frame(L),pch = 21,cex = 0.8)
```
