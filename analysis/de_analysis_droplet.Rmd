---
title: "GoM DE analysis of droplet data"
author: Peter Carbonetto
output: workflowr::wflow_html
---

Here we summarize the results of performing DE analysis on the droplet
data using the topic model with $K = 7$ topics.

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.align = "center",dpi = 120)
```

Load the packages used in the analysis.

```{r load-pkgs, message=FALSE}
library(fastTopics)
library(ggplot2)
library(cowplot)
```

Load the results of the differential expression analysis.

```{r load-results}
load("../output/droplet/de-droplet.RData")
```

For reference, here is the Structure plot from 
[an earlier analysis of the droplet data](clusters_droplet.html):

<img src="figure/clusters_droplet.Rmd/structure-plot-1.png" width=1920
style="display: block; margin: auto;">

These volcano plots summarize the results off the DE analysis after
merging topics 5 and 7:

```{r volcano-plots-1, fig.height=10.75, fig.width=8}
p1 <- volcano_plot(de_merged,ymax = 100,k = "k1")
p2 <- volcano_plot(de_merged,ymax = 200,k = "k2")
p3 <- volcano_plot(de_merged,ymax = 200,k = "k3")
p4 <- volcano_plot(de_merged,ymax = 200,k = "k4")
p5 <- volcano_plot(de_merged,ymax = 200,k = "k5+k7")
p6 <- volcano_plot(de_merged,ymax = 100,k = "k6")
plot_grid(p1,p2,p3,p4,p5,p6,nrow = 3,ncol = 2)
```

Judging by the most overexpressed genes in these volcano plots, the
topics capture goblet cells (topic 1), basal cells (topic 2),
"hillock" club cells (topic 4), ciliated, tuft and neuroendocrine
cells (topic 6), and club cells (topics 5 + 7).

Topic 7 is driven by variation in expression of *Scgb1a1* in club
cells:

```{r volcano-plots-2, fig.height=3.75, fig.width=8}
p7 <- volcano_plot(de,k = "k5",ymax = 200)
p8 <- volcano_plot(de,k = "k7",ymax = 200)
plot_grid(p7,p8)
```

These same results can also be explored in interactive volcano plots:

```{r volcano-plotly, results="hide", warning=FALSE}
volcano_plotly(de_merged,k = "k1",ymax = 100,
               file = "volcano_plot_droplet_goblet.html",
               width = 600,height = 600)
volcano_plotly(de_merged,k = "k2",ymax = 200,
               file = "volcano_plot_droplet_basal.html",
               width = 600,height = 600)
volcano_plotly(de_merged,k = "k3",ymax = 200,
               file = "volcano_plot_droplet_k3.html",
               width = 600,height = 600)
volcano_plotly(de_merged,k = "k4",ymax = 200,
               file = "volcano_plot_droplet_hillock.html",
               width = 600,height = 600)
volcano_plotly(de_merged,k = "k5+k7",ymax = 200,
               file = "volcano_plot_droplet_club.html",
               width = 600,height = 600)
volcano_plotly(de_merged,k = "k6",ymax = 100,
               file = "volcano_plot_droplet_rare.html",
               width = 600,height = 600)
volcano_plotly(de,k = "k5",ymax = 200,
               file = "volcano_plot_droplet_club_splunc1.html",
               width = 600,height = 600)
volcano_plotly(de,k = "k7",ymax = 200,
               file = "volcano_plot_droplet_club_scgb1a1.html",
               width = 600,height = 600)
```

You can explore these interactive volcano plots by following these
links:

+ [topic 1 (goblet cells)](volcano_plots/volcano_plot_droplet_goblet.html)

+ [topic 2 (basal cells)](volcano_plots/volcano_plot_droplet_basal.html)

+ [topic 3](volcano_plots/volcano_plot_droplet_k3.html)

+ [topic 4 (hillock cells)](volcano_plots/volcano_plot_droplet_hillock.html)

+ [topic 5 + 7 (club cells)](volcano_plots/volcano_plot_droplet_club.html)

+ [topic 6 (rare cell types)](volcano_plots/volcano_plot_droplet_rare.html)

+ [topic 5 (Splunc1+ club cells)](volcano_plots/volcano_plot_droplet_club_splunc1.html)

+ [topic 7 (Scgb1a1+ club cells)](volcano_plots/volcano_plot_droplet_club_scgb1a1.html)

```{r volcano-plots-for-paper, echo=FALSE}
ggsave("../plots/volcano_plots_droplet_part1.eps",
       plot_grid(p1,p2,p3,p4,p5,p6,nrow = 2,ncol = 3),
	   height = 7,width = 12.5)
ggsave("../plots/volcano_plots_droplet_part2.eps",
       plot_grid(p7,p8),
	   height = 3.5,width = 8.5)
```
