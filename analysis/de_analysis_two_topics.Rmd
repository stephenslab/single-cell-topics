---
title: "Evaluation of fastTopics DE analysis methods in simulations---case of 2 topics"
author: Peter Carbonetto
output: workflowr::wflow_html
---

Here we evaluate performance of the grade-of-membership DE methods in
simulations, focussing on the case of $K = 2$ topics. A smaller
simulation with $K = 2$ topics was first performed
[here](de_analysis_detailed_look.html), and based on this initial
simulation we have conducted a larger set of simulations using the
`run_sims.R` script. Here we summarize the results of this larger set
of simulations.

```{r knitr-opts, include=FALSE}
knitr::opts_chunk$set(comment = "#",collapse = TRUE,results = "hold",
                      fig.show = "hold",fig.align = "center",dpi = 120)
```

Load the packages needed for this analysis, and some additional
functions used to compile the results and generate the plots.

```{r load-pkgs, message=FALSE, warning=FALSE}
library(Matrix)
library(fastTopics)
library(ggplot2)
library(cowplot)
source("../code/de_analysis_functions.R")
```

Load the results of the simulations.

```{r load-sims}
load("../output/sims/sims-k=2.RData")
```

These were the R packages used to run the simulations:

```{r session-info}
res$session.info
```

Before comparing the methods, we first assess accuracy of the Monte
Carlo computations by comparing the estimates from two independent
MCMC runs.

```{r mcmc-scatterplots, fig.height=3, fig.width=6}
pdat <- data.frame(lfc1 = combine_sim_res(res,function (x) x$de1$postmean[,2]),
                   lfc2 = combine_sim_res(res,function (x) x$de2$postmean[,2]),
                   z1   = combine_sim_res(res,function (x) x$de1$z[,2]),
		           z2   = combine_sim_res(res,function (x) x$de2$z[,2]))
p1 <- ggplot(pdat,aes(x = lfc1,y = lfc2)) +
  geom_point(color = "dodgerblue",shape = 4,size = 0.75) +
  geom_abline(intercept = 0,slope = 1,linetype = "dotted") +
  labs(x = "first posterior mean",y = "second posterior mean") +
  theme_cowplot(font_size = 12)
p2 <- ggplot(pdat,aes(x = z1,y = z2)) +
  geom_point(color = "dodgerblue",shape = 4,size = 0.75) +
  geom_abline(intercept = 0,slope = 1,linetype = "dotted") +
  labs(x = "first z-score estimate",y = "second z-score estimate") +
  theme_cowplot(font_size = 12)
plot_grid(p1,p2)
```

The estimates of the posterior mean LFCs and *z*-scores generated by
both MCMC runs are very similar.

```{r mcmc-scatterplots-for-paper, echo=FALSE}
ggsave("../plots/mcmc_scatterplots_sims_k=2.png",
       plot_grid(p1,p2),height = 3,width = 6,dpi = 600)
```
